<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">


    <div class="container">
    	<h:messages/>
    	<h:form id="projectForm">
            <div class="form-group">
                <label for="name">Name:</label>
                <h:inputText id="name" class="form-control" value="#{projectAdministrationBean.projectForm.name}" required="true" requiredMessage="Name is required" autocomplete="off"/>
                <div class="text-left" style="color:red;">
                    <h:message for="name" id="errProjectname"/>
                </div>
           	</div>
            <div class="form-group">
                <label for="firstName">Description:</label>
                <h:inputTextarea id="description" class="form-control" value="#{projectAdministrationBean.projectForm.description}" autocomplete="off" />
            </div>
            <div class="form-group">
                <label for="startDate">Start Date:</label>
                <p:datePicker id="startDate" value="#{projectAdministrationBean.projectForm.startDate}" widgetVar="startDateWidget"  required="true" requiredMessage="Start date is required" pattern="yyyy-MM-dd" showOn="button" mode="date"  showTime="false"  converter="localDateTimeConverter"/>
<!--                 <p:calendar id="startDate" class="form-control" value="#{projectAdministrationBean.projectForm.startDate}" required="true" requiredMessage="Start date is required" pattern="yyyy-MM-dd" showOn="button" /> -->
    
                
                <div class="text-left" style="color:red;">
                    <h:message for="startDate" id="errProjectStartDate"/>
                </div>
            </div>
            <div class="form-group">
                <label for="endDate">End Date:</label>
                <p:datePicker id="endDate" value="#{projectAdministrationBean.projectForm.endDate}" widgetVar="endDateWidget"  required="true" requiredMessage="End date is required" pattern="yyyy-MM-dd" showOn="button" mode="date"  showTime="false"  converter="localDateTimeConverter"/>
<!--                 <h:inputText id="endDate" class="form-control" value="#{projectAdministrationBean.projectForm.endDate}" required="true" requiredMessage="End date is required" autocomplete="off"  converter="localDateTimeConverter"/> -->
                <div class="text-left" style="color:red;">
                    <h:message for="endDate" id="errProjectEndDate"/>
                </div>
            </div>
            <h:inputHidden id="id" value="#{projectAdministrationBean.projectForm.id}" />
            <h:inputHidden id="responseHidden" value="#{projectAdministrationBean.response.result}" />
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                 <h:commandButton id="saveButton" value="Save" action="#{projectAdministrationBean.saveProject(projectAdministrationBean.projectForm.id)}" styleClass="btn btn-primary">
			        <f:ajax execute="@form" render="@form" onevent="handleSaveEvent"/>
			    </h:commandButton>
            </div>
        </h:form>
    </div>

	<script>
		
		function handleSaveEvent(data) {
	        console.log(data);
			if (data.status === 'success') {
				var responseString = document.getElementById('projectForm:responseHidden').value;
				console.log(JSON.parse(responseString));
				
		        if (JSON.parse(responseString) === true) {
		        	document.getElementById('projectForm:responseHidden').value = 'false';
		        	reloadProjectList();
		        	$('#createProjectModal').modal('hide');
		            
		        }
	        }
	    }

		function reloadProjectList() {
			console.log('reloading list');
	        $.ajax({
	            url: "/Projects/ProjectList.xhtml",
	            method: "GET",
	            success: function(data) {
	                $("#projectListForm").html(data);
	            },
	            error: function(xhr, status, error) {
	                console.error("Error reloading Project List:", error);
	            }
	        });
	    }
    </script>
</ui:composition>
