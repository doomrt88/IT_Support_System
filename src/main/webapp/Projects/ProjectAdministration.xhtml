<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">
                

    
    <div class="container">
        <h2>Project Management</h2>
		<button type="button" class="btn btn-outline-primary btn-sm mb-3"  onclick="loadProjectForm(false, 0);"><i class="fas fa-plus"></i> Create</button>
        <div id="projectListForm">
            <ui:include src="/Projects/ProjectList.xhtml" />
        </div>
        
        
        <div class="modal fade" id="createProjectModal" tabindex="-1" project="dialog" aria-labelledby="modalTitle" aria-hidden="true">
	        <div class="modal-dialog" project="document">
	            <div class="modal-content">
	                <div class="modal-header">
	                    <h5 class="modal-title" id="createProjectModalTitle">Create Project</h5>
	                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	                        <span aria-hidden="true">x</span>
	                    </button>
	                </div>
	                <div class="modal-body">
	                    <ui:include src="/Projects/ProjectForm.xhtml" />
	                </div>
						                
	            </div>
	        </div>
	    </div>
    </div>
	<script>
	
    function loadProjectForm(isEdit, project) {
		console.log(project);
	    console.log("I'm clicked");
	    if (isEdit) {
	        $('#createProjectModalTitle').text('Edit Project');
	    } else {
	        $('#createProjectModalTitle').text('Create Project');
	    }
	    
	    $.ajax({
	        url: "/Projects/ProjectForm.xhtml",
	        method: "GET",
	        success: function(data) {
	            // Load the response data into the modal body
	            $("#createProjectModal .modal-body").html(data);
	         // Show the modal
	            $('#createProjectModal').modal('show');
	            // If it's an edit operation, load the project details
	            if (isEdit) {
	                loadProjectData(project);
	            }
	            
	            
	        },
	        error: function(xhr, status, error) {
	            console.error("Error loading ProjectForm:", error);
	        }
	    });
	}

    function loadProjectData(projectJson) {
		var project = JSON.parse(projectJson);
	    
	    // Populate the form fields with the project data
	    $('#projectForm\\:id').val(project.id);
	    $('#projectForm\\:name').val(project.name);
	    $('#projectForm\\:description').val(project.description);

	 	// Convert and set the start date
	    var startDate = new Date(project.startDate);
	    var startDateUTC = convertToUTC(startDate);
	    $('#projectForm\\:startDate_input').val(startDateUTC.toISOString().slice(0,10));

	    // Convert and set the end date
	    var endDate = new Date(project.endDate);
	    var endDateUTC = convertToUTC(endDate);
	    $('#projectForm\\:endDate_input').val(endDateUTC.toISOString().slice(0,10));
	    
// 	    var startDate = new Date(project.startDate);
// 	    $('#projectForm\\:startDate_input').val(startDate.toISOString().slice(0,10));

// 	    // Parse and set the end date
// 	    var endDate = new Date(project.endDate);
// 	    $('#projectForm\\:endDate_input').val(endDate.toISOString().slice(0,10));
	    
// 	    var startDate = project.startDate.split('T')[0];
// 	    var endDate = project.endDate.split('T')[0];
// 	    $('#projectForm\\:startDate_input').val(startDate)
// 	    $('#projectForm\\:endDate_input').val(endDate)
	    

	    
	}

    function convertToUTC(date) {
        var year = date.getFullYear();
        var month = date.getMonth();
        var day = date.getDate();
        var hours = date.getHours();
        var minutes = date.getMinutes();
        var seconds = date.getSeconds();

        // Create a new Date object with the UTC values
        var utcDate = new Date(Date.UTC(year, month, day, hours, minutes, seconds));

        return utcDate;
    }
	
    </script>
    
   </ui:composition>