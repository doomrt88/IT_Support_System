<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core">


    <div class="container">
    	<h:messages/>
    	<h:form id="roleForm">
            <div class="form-group">
                <label for="name">Name:</label>
                <h:inputText id="name" class="form-control" value="#{roleAdministrationBean.roleForm.name}" required="true" requiredMessage="Name is required" autocomplete="off"/>
                <div class="text-left" style="color:red;">
                    <h:message for="name" id="errRolename"/>
                </div>
           	</div>
            <div class="form-group">
                <label for="firstName">Description:</label>
                <h:inputTextarea id="description" class="form-control" value="#{roleAdministrationBean.roleForm.description}" autocomplete="off" />
            </div>
            <h:inputHidden id="id" value="#{roleAdministrationBean.roleForm.id}" />
            <h:inputHidden id="responseHidden" value="#{roleAdministrationBean.response.result}" />
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                 <h:commandButton id="saveButton" value="Save" action="#{roleAdministrationBean.saveRole(roleAdministrationBean.roleForm.id)}" styleClass="btn btn-primary">
			        <f:ajax execute="@form" render="@form" onevent="handleSaveEvent"/>
			    </h:commandButton>
            </div>
        </h:form>
    </div>

	<script>
		
		function handleSaveEvent(data) {
	        console.log(data);
			if (data.status === 'success') {
				var responseString = document.getElementById('roleForm:responseHidden').value;
				console.log(JSON.parse(responseString));
				
		        if (JSON.parse(responseString) === true) {
		        	document.getElementById('roleForm:responseHidden').value = 'false';
		        	reloadRoleList();
		        	$('#createRoleModal').modal('hide');
		            
		        }
	        }
	    }

		function reloadRoleList() {
			console.log('reloading list');
	        $.ajax({
	            url: "/Roles/RoleList.xhtml",
	            method: "GET",
	            success: function(data) {
	                $("#roleListForm").html(data);
	            },
	            error: function(xhr, status, error) {
	                console.error("Error reloading Role List:", error);
	            }
	        });
	    }
    </script>
</ui:composition>
