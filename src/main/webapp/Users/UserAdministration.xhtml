<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">
                

    
    <div class="container">
        <h2>User Management</h2>
		<button type="button" class="btn btn-outline-primary btn-sm mb-3"  onclick="loadUserForm(false, 0);"><i class="fas fa-plus"></i> Create</button>
        <div id="userListForm">
            <ui:include src="/Users/UserList.xhtml" />
        </div>
        
        
        <div class="modal fade" id="createUserModal" tabindex="-1" role="dialog" aria-labelledby="modalTitle" aria-hidden="true">
	        <div class="modal-dialog" role="document">
	            <div class="modal-content">
	                <div class="modal-header">
	                    <h5 class="modal-title" id="createUserModalTitle">Create User</h5>
	                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	                        <span aria-hidden="true">x</span>
	                    </button>
	                </div>
<!-- 	                <div class="modal-body" id="userFormContainer"> -->
                        
<!--                     </div> -->
	                <div class="modal-body">
	                    <ui:include src="/Users/UserForm.xhtml" />
	                </div>
						                
	            </div>
	        </div>
	    </div>
    </div>
	<script>

	function loadUserForm(isEdit, user) {
		console.log(user);
	    console.log("I'm clicked");
	    if (isEdit) {
	        $('#createUserModalTitle').text('Edit User');
	    } else {
	        $('#createUserModalTitle').text('Create User');
	    }
	    
	    $.ajax({
	        url: "/Users/UserForm.xhtml",
	        method: "GET",
	        success: function(data) {
	            // Load the response data into the modal body
	            $("#createUserModal .modal-body").html(data);
	            
	            // If it's an edit operation, load the user details
	            if (isEdit) {
	                loadUserData(user);
	            }
	            
	            // Show the modal
	            $('#createUserModal').modal('show');
	        },
	        error: function(xhr, status, error) {
	            console.error("Error loading UserForm:", error);
	        }
	    });
	}

	function loadUserData(userJson) {
		var user = JSON.parse(userJson);
	    
	    // Populate the form fields with the user data
	    $('#userForm\\:username').val(user.username);
	    $('#userForm\\:password').val(user.password);
	    $('#userForm\\:confirmPassword').val(user.confirmPassword);
	    $('#userForm\\:firstName').val(user.firstName);
	    $('#userForm\\:lastName').val(user.lastName);
	    $('#userForm\\:roleId').val(user.roleId);
	    $('#userForm\\:id').val(user.id);
	    /*$.ajax({
	        url: "/Users/editUser",
	        method: "GET",
	        data: { userId: userId },
	        success: function(userData) {
		        console.log(userData);
	            $('#username').val(userData.username);
	            $('#firstName').val(userData.firstName);
	            $('#lastName').val(userData.lastName);
	        },
	        error: function(xhr, status, error) {
	            console.error("Error loading user data:", error);
	        }
	    });*/
	}

    
	/*function loadUserForm(isEdit, userId) {
		console.log("I'm clicked");
        if (isEdit) {
            $('#createUserModalTitle').text('Edit User');
        } else {
            $('#createUserModalTitle').text('Create User');
        }
        
        var url = isEdit ? "/Users/EditUser.xhtml?userId=" + userId : "/Users/CreateUser.xhtml";
        $.ajax({
            url: url,
            method: "GET",
            success: function(data) {
                $("#createUserModal .modal-body").html(data);
                $('#createUserModal').modal('show');
            },
            error: function(xhr, status, error) {
                console.error("Error loading User Form:", error);
            }
        });
    }*/
    
/*         function loadUserForm() {
            $('#createUserModal').modal('show');
            // AJAX call to load the User Form content dynamically
//             $.ajax({
//                 url: "/Users/UserForm.xhtml",
//                 method: "GET",
//                 success: function(data) {
//                     $("#userFormContainer").html(data); // Inject the loaded content into the modal body
//                 },
//                 error: function(xhr, status, error) {
//                     console.error("Error loading User Form:", error);
//                 }
//             });
        } */
    </script>
<!-- 	<script> -->

	
<!--      function openCreateUserModal() { -->
<!--      	//openGenericModal('Add User', '/Users/UserForm.xhtml', onSave); -->
<!--      	openGenericModal( -->
<!--      	        'Add User',  -->
<!--      	        '/Users/UserForm.xhtml', -->
<!--      	        function(onSaveCallback) { -->
<!--          	        console.log("#{userAdministrationBean.register()}"); -->
<!--      	            $.ajax({ -->
<!--      	                type: 'POST', -->
<!--      	                url: "#{userAdministrationBean.register()}", -->
<!--      	                data: $('#userForm').serialize(), -->
<!--      	                success: function(response) { -->
<!--  	    	                console.log(response); -->
<!--      	                    // Invoke the callback with true indicating success -->
<!--      	                    onSaveCallback(true); -->
<!--      	                }, -->
<!--      	                error: function(xhr, status, error) { -->
<!--      	                	console.log(error); -->
<!--      	                    // Invoke the callback with false indicating failure -->
<!--      	                    onSaveCallback(false); -->
<!--      	                } -->
<!--      	            }); -->
<!--      	        } -->
<!--      	    ); -->
   </ui:composition>