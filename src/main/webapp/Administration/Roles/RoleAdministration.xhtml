<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<div class="container">
		<h2>Role Management</h2>

		<p:commandButton value="Create Role"
			action="#{roleAdministrationBean.createRole}" update="roleForm"
			onclick="PF('roleDialog').show()" styleClass="mb-3"/>
		<h:form id="roleListForm">
			<p:growl id="roleMessages" showDetail="true" />
			<p:dataTable id="rolesTable"
				value="#{roleAdministrationBean.roleList}" var="role"
				styleClass="table striped table-sm" paginator="true" rows="5"  paginatorPosition="bottom">
				<p:column headerText="Name">#{role.name}</p:column>
				<p:column headerText="Description">#{role.description}</p:column>
				<p:column headerText="Action">
					<p:commandButton value="Edit"
						action="#{roleAdministrationBean.editRole(role)}" 
						oncomplete="PF('roleDialog').show()" update="roleDialog"
						styleClass="ui-button-outlined mr-2" />

					<p:commandButton value="Delete"
						action="#{roleAdministrationBean.deleteRole(role.id)}"
						onclick="return confirm('Are you sure you want to delete role #{role.name}?')"
						update=":roleListForm:rolesTable :roleListForm:roleMessages"
						styleClass="ui-button-outlined ui-button-danger">
						<f:ajax execute="@this" render="@form" />
					</p:commandButton>
				</p:column>
			</p:dataTable>
		</h:form>
	</div>

	<p:dialog id="roleDialog" widgetVar="roleDialog" modal="true"
		resizable="false" showEffect="fade" hideEffect="fade">
		<h:form id="roleForm">
			<h:inputHidden id="id" value="#{roleAdministrationBean.roleForm.id}" />
			<div class="form-group">
				<label for="name">Name:</label>
				<h:inputText id="name" class="form-control"
					value="#{roleAdministrationBean.roleForm.name}" required="true"
					requiredMessage="Name is required" autocomplete="off" />
				<div class="text-left" style="color: red;">
					<h:message for="name" id="errRolename" />
				</div>
			</div>
			<div class="form-group">
				<label for="description">Description:</label>
				<h:inputTextarea id="description" class="form-control"
					value="#{roleAdministrationBean.roleForm.description}"
					autocomplete="off" />
			</div>

			<div class="form-group">
				<label>Permissions:</label>
				<p:selectManyCheckbox id="permissions"
					value="#{roleAdministrationBean.roleForm.permissions}"
					layout="responsive" columns="3"
					styleClass="grid-checkbox col-md-12">
					<f:selectItems value="#{roleAdministrationBean.permissions}"
						var="permission" itemLabel="#{permission}"
						itemValue="#{permission}" />
						<f:ajax render="permissions" />
				</p:selectManyCheckbox>
			</div>

			<p:commandButton id="saveButton" value="Save"
				action="#{roleAdministrationBean.saveRole}" styleClass="mr-2"
				oncomplete="handleSaveRoleEvent(xhr, status, args)"  update=":roleListForm:rolesTable :roleListForm:roleMessages" />
			<p:commandButton type="button" value="Cancel"
				onclick="PF('roleDialog').hide()" styleClass="ui-button-warning" />
		</h:form>
		
		<f:facet name="header">
	        <h:outputText value="#{roleAdministrationBean.roleForm.id > 0 ? 'Update Role' : 'Add New Role'}" />
	    </f:facet>
	</p:dialog>

	<script>
		function handleSaveRoleEvent(xhr, status, args) {
			console.log(status);
			console.log(args);
	        if (!args.validationFailed) {
	            PF('roleDialog').hide();
	        }
	    }
    </script>

</ui:composition>
