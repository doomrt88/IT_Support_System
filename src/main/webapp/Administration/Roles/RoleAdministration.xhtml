<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<div class="container">
		<h3 class="mb-4">Role Management</h3>
		<h:form id="roleListForm">
			<p:growl id="roleMessages" showDetail="true" />
			<p:toolbar>
	            <p:toolbarGroup>
	                <p:commandButton value="New Role" icon="pi pi-plus" actionListener="#{roleAdministrationBean.openNew}"
	                    update=":roleForm" oncomplete="PF('roleDialog').show()"
	                    styleClass="ui-button-success" style="margin-right: .5rem">
	                    <p:resetInput target=":roleForm" />
	                </p:commandButton>
	            </p:toolbarGroup>
	        </p:toolbar>
	        
	        
			<p:dataTable id="rolesTable"
				value="#{roleAdministrationBean.roleList}" var="role"
				styleClass="table striped table-sm mt-2" paginator="true" rows="5"  paginatorPosition="bottom">
				<p:column headerText="Name">#{role.name}</p:column>
				<p:column headerText="Description">#{role.description}</p:column>
				
				<p:column headerText="" styleClass="text-center">
					<p:commandButton 
						action="#{roleAdministrationBean.editRole(role)}"  icon="pi pi-pencil"
						oncomplete="PF('roleDialog').show()" update="roleDialog"
						styleClass="edit-button rounded-button ui-button-success mr-1" />

					<p:commandButton 
						action="#{roleAdministrationBean.deleteRole(role.id)}" icon="pi pi-trash"
						onclick="return confirm('Are you sure you want to delete role #{role.name}?')"
						update=":roleListForm:rolesTable :roleListForm:roleMessages"
						styleClass="ui-button-danger rounded-button">
						<f:ajax execute="@this" render="@form" />
					</p:commandButton>
				</p:column>		
				
			</p:dataTable>
		</h:form>
	</div>

	<p:dialog id="roleDialog" widgetVar="roleDialog" modal="true"
		resizable="false" showEffect="fade" hideEffect="fade">
		<h:form id="roleForm">
			<h:inputHidden id="id" value="#{roleAdministrationBean.roleForm.id}" />
			<div class="form-group">
				<label for="name">Name:</label>
				<h:inputText id="name" class="form-control"
					value="#{roleAdministrationBean.roleForm.name}" required="true"
					requiredMessage="Name is required" autocomplete="off" />
				<div class="text-left" style="color: red;">
					<h:message for="name" id="errRolename" />
				</div>
			</div>
			<div class="form-group">
				<label for="description">Description:</label>
				<h:inputTextarea id="description" class="form-control"
					value="#{roleAdministrationBean.roleForm.description}"
					autocomplete="off" />
			</div>

			<div class="form-group">
				<label>Permissions:</label>
				<p:selectManyCheckbox id="permissions"
					value="#{roleAdministrationBean.roleForm.permissions}"
					layout="responsive" columns="3"
					styleClass="grid-checkbox col-md-12">
					<f:selectItems value="#{roleAdministrationBean.permissions}"
						var="permission" itemLabel="#{permission}"
						itemValue="#{permission}" />
						<f:ajax render="permissions" />
				</p:selectManyCheckbox>
			</div>

			<p:commandButton id="saveButton" value="Save"
				action="#{roleAdministrationBean.saveRole}" styleClass="mr-2" icon="pi pi-check"
				oncomplete="handleSaveRoleEvent(xhr, status, args)"  update=":roleListForm:rolesTable :roleListForm:roleMessages" />
			<p:commandButton type="button" value="Cancel"  icon="pi pi-times"
				onclick="PF('roleDialog').hide()" styleClass="ui-button-secondary" />
		</h:form>
		
		<f:facet name="header">
	        <h:outputText value="#{roleAdministrationBean.roleForm.id > 0 ? 'Update Role' : 'Add New Role'}" />
	    </f:facet>
	</p:dialog>

	<script>
		function handleSaveRoleEvent(xhr, status, args) {
			console.log(status);
			console.log(args);
	        if (!args.validationFailed) {
	            PF('roleDialog').hide();
	        }
	    }
    </script>

</ui:composition>
