<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<div class="container">
		<h3 class="mb-4">Project Management</h3>
		<h:form id="projectListForm">
			<p:growl id="projectMessages" showDetail="true" />
			<p:toolbar>
	            <p:toolbarGroup>
	                <p:commandButton value="New Project" icon="pi pi-plus" actionListener="#{projectAdministrationBean.openNew}"
	                    update=":projectForm" oncomplete="PF('projectDialog').show()"
	                    styleClass="ui-button-success" style="margin-right: .5rem">
	                    <p:resetInput target=":projectForm" />
	                </p:commandButton>
	            </p:toolbarGroup>
	        </p:toolbar>
	        
			<p:dataTable id="projectsTable"
				value="#{projectAdministrationBean.projectList}" var="project"
				styleClass="table striped table-sm mt-2" paginator="true" rows="5"  paginatorPosition="bottom">
				<p:column headerText="Name">#{project.name}</p:column>
				<p:column headerText="Description">#{project.description}</p:column>
				<p:column headerText="Start Date">
				    <h:outputText value="#{projectAdministrationBean.formatDateTime(project.startDate)}" />
				</p:column>
				<p:column headerText="End Date">
				    <h:outputText value="#{projectAdministrationBean.formatDateTime(project.endDate)}" />
				</p:column>


				<p:column headerText="" styleClass="text-center">
					<p:commandButton 
						action="#{projectAdministrationBean.editProject(project)}"  icon="pi pi-pencil"
						oncomplete="PF('projectDialog').show()" update="projectDialog"
						styleClass="edit-button rounded-button ui-button-success mr-1" />

					<p:commandButton 
						action="#{projectAdministrationBean.deleteProject(project.id)}" icon="pi pi-trash"
						onclick="return confirm('Are you sure you want to delete project #{project.name}?')"
						update=":projectListForm:projectsTable :projectListForm:projectMessages"
						styleClass="ui-button-danger rounded-button">
						<f:ajax execute="@this" render="@form" />
					</p:commandButton>
				</p:column>					
			</p:dataTable>
		</h:form>
	</div>

	<p:dialog id="projectDialog" widgetVar="projectDialog" modal="true" minHeight="40" width="450" 
		resizable="false" showEffect="fade" hideEffect="fade">
		<h:form id="projectForm">
			<h:inputHidden id="id" value="#{projectAdministrationBean.projectForm.id}" />
			<div class="form-group">
				<label for="name">Name:</label>
				<h:inputText id="name" class="form-control"
					value="#{projectAdministrationBean.projectForm.name}" required="true"
					requiredMessage="Name is required" autocomplete="off" />
				<div class="text-left" style="color: red;">
					<h:message for="name" id="errProjectname" />
				</div>
			</div>
			<div class="form-group">
				<label for="description">Description:</label>
				<h:inputTextarea id="description" class="form-control"
					value="#{projectAdministrationBean.projectForm.description}"
					autocomplete="off" />
			</div>
			<div class="form-group">
                <label for="startDate">Start Date:</label>
                <p:datePicker id="startDate" value="#{projectAdministrationBean.projectForm.startDate}" widgetVar="startDateWidget"  required="true" requiredMessage="Start date is required" pattern="yyyy-MM-dd" showOn="button" mode="date"  showTime="false"  converter="localDateTimeConverter"/>
         
                <div class="text-left" style="color:red;">
                    <h:message for="startDate" id="errProjectStartDate"/>
                </div>
            </div>
            <div class="form-group">
                <label for="endDate">End Date:</label>
                <p:datePicker id="endDate" value="#{projectAdministrationBean.projectForm.endDate}" widgetVar="endDateWidget"  required="true" requiredMessage="End date is required" pattern="yyyy-MM-dd" showOn="button" mode="date"  showTime="false"  converter="localDateTimeConverter"/>
                <div class="text-left" style="color:red;">
                    <h:message for="endDate" id="errProjectEndDate"/>
                </div>
            </div>

			<p:commandButton id="saveButton" value="Save"
				action="#{projectAdministrationBean.saveProject}" styleClass="mr-2" icon="pi pi-check"
				oncomplete="handleSaveProjectEvent(xhr, status, args)"  update=":projectListForm:projectsTable :projectListForm:projectMessages" />
			<p:commandButton type="button" value="Cancel"  icon="pi pi-times"
				onclick="PF('projectDialog').hide()" styleClass="ui-button-secondary" />
		</h:form>
		
		
		<f:facet name="header">
	        <h:outputText value="#{projectAdministrationBean.projectForm.id > 0 ? 'Update Project' : 'Add New Project'}" />
	    </f:facet>
	</p:dialog>

	<script>
		function handleSaveProjectEvent(xhr, status, args) {
			console.log(status);
			console.log(args);
	        if (!args.validationFailed) {
	            PF('projectDialog').hide();
	        }
	    }
    </script>

</ui:composition>
